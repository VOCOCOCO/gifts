<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>–†—É–ª–µ—Ç–∫–∞ –∏ –≤–∫–ª–∞–¥–∫–∏</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
  <script src="https://unpkg.com/embla-carousel/embla-carousel.umd.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –°—Ç–∏–ª–∏ -->
  <style>
    body {
      overflow-y: 1000;
      margin: 0;
      padding: 0;
      background-color: #0d1117;
      color: white;
      font-family: Arial, sans-serif;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0d1117; }
    ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #484f58; }

    #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .spinner { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #00bfff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    #app { display: none; }

    .tab-container { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: center; padding: 7px; background-color: #222; border-top: 2px solid #444; z-index: 1000; }
    .tab { width: 40px; height: 40px; margin: 0 15px; background-color: #333; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; border-radius: 5px; }
    .tab:hover { background-color: #555; }
    .tab.active { background-color: #95cdff1e; transform: scale(1.01); }
    .tab img { width: 100%; height: 100%; object-fit: contain; }

    .tab-content { display: none; padding-bottom: 80px; }
    .tab-content.active { display: block; }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–∏ (–Ω–µ —Ç—Ä–æ–≥–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ) */
    .top-bar { position: fixed; top: 0; left: 0; width: 100%; background: #161b22; padding: 6px 15px; display: flex; align-items: center; z-index: 1000; border-bottom: 1px solid #2e2e2e; }
    .top-bar img { width: 36px; height: 36px; border-radius: 50%; margin-right: 10px; }
    .top-bar span { font-size: 16px; font-weight: bold; }
    .container { padding: 69px 20px 20px; max-width: 600px; margin: 0 auto; box-sizing: border-box; }
    .news-banner { width: 100%; height: 56px; background: linear-gradient(to right, #36bfff, #5e9fff); border-radius: 15.5px; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; font-weight: 600; font-size: 16px; margin-bottom: 12px; box-sizing: border-box; }
    .news-banner button { background: white; color: #5e9fff; border: none; padding: 8px 12px; border-radius: 12px; font-weight: 600; cursor: pointer; }
    .mode-selector { display: flex; justify-content: center; background: #1c1c1e; border-radius: 16px; padding: 4px; margin-bottom: 12px; gap: 4px; }
    .mode-option { flex: 1; padding: 8px 0; text-align: center; border-radius: 12px; color: white; font-weight: 650; font-size: 15px; transition: background-color 0.25s ease, color 0.25s ease; background: transparent; user-select: none; -webkit-tap-highlight-color: transparent; }
    .mode-option.active { background: #2c2c2e; }
    .reel { position: relative; width: 100%; height: 130px; overflow: hidden; border-radius: 12px; background: rgba(255,255,255,0.06); backdrop-filter: blur(6px); margin-bottom: 20px; }
    .gifts-wrapper { display: flex; height: 100%; align-items: center; will-change: transform; }
    .gift { width: 100px; height: 100px; background: rgba(255,255,255,0.08); border-radius: 15px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; margin: 0 10px; }
    .gift img { max-width: 90px; max-height: 90px; }
    .pointer-line { position: absolute; top: 0; left: 50%; width: 4px; height: 100%; background: rgba(0,200,255,0.5); transform: translateX(-50%); z-index: 10; }
    button#spinButton { background-color: #2ea1f8; border: none; color: white; padding: 12px 24px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 5px; }
    .extra-button { display: block; width: 100%; padding: 11px 24px; background-color: transparent; color: white; font-size: 15px; font-weight: bold; text-align: center; text-decoration: none; border: 3px solid rgba(255, 255, 255, 0.7); border-radius: 9px; margin-top:5px; margin-bottom: 15px; box-sizing: border-box; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
    .extra-button:hover { background-color: rgba(255, 255, 255, 0.05); border-color: white; }

    .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.908); backdrop-filter: blur(45px); display: none; align-items: center; justify-content: center; z-index: 9999; flex-direction: column; padding: 20px; box-sizing: border-box; }
    .modal-image { max-width: 90%; max-height: 60%; object-fit: contain; margin-top: -20px; margin-bottom: 15px; }
    .modal h2 { font-size: 24px; color: #00ffcc; margin: 0; text-align: center; }
    .modal button { font-size: 16px; margin-top: 30px; padding: 10px 26px; width: 90%; }

    .swipe-text { font-size: 17px; margin-bottom: 12px; padding-left: 10px; font-weight: bold; }
    .embla { overflow: hidden; width: 100%; }
    .embla__container { display: flex; }
    .embla__slide { flex: 0 0 auto; width: 70px; height: 70px; margin-right: 10px; background: rgba(255,255,255,0.08); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
    .embla__slide img { max-width: 60px; max-height: 60px; }
    .footer-text { font-size: 12px; color: #888; text-align: center; margin: 5% 0 10px; }

    .extra-button.outlined { background-color: transparent; border: 2px solid white; color: white; font-weight: bold; text-align: center; font-size: 15px; padding: 10px 24px; border-radius: 8px; text-decoration: none; display: inline-block; width: 100%; margin-top: 5px; box-sizing: border-box; transition: all 0.2s ease; }
    .extra-button.outlined:hover { background-color: rgba(255,255,255,0.05); border-color: #ffffff; }

    /* ========== –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ 2 (–Ω–æ–≤—ã–µ) ========== */
    .tab2-wrapper {
      padding: 60px 20px 120px;
      max-width: 700px;
      margin: 0 auto;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    .rules-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1100;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
    }

    .lotto-grid {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      justify-items: center;
      align-items: center;
    }

    /* –∫–∞–∂–¥—ã–π –∫—É–±–∏–∫ */
    .cube {
      width: 160px;
      height: 160px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: visible;
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
      touch-action: none; /* –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —É–¥–µ—Ä–∂–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      user-select: none;
    }
    .cube .lottie-holder {
      width: 120px;
      height: 120px;
      pointer-events: none; /* —á—Ç–æ–±—ã –Ω–∞–∂–∞—Ç–∏–µ —à–ª–æ –Ω–∞ cube –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–∏ lottie */
    }
    .cube .hold-hint {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #aaa;
    }
    .hold-overlay {
      position: absolute;
      inset: 0;
      border-radius: 14px;
      pointer-events: none;
      box-shadow: inset 0 0 0 2px transparent;
      transition: box-shadow 0.12s linear;
    }

    .hold-progress {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      height: 6px;
      background: rgba(255,255,255,0.06);
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
      overflow: hidden;
    }
    .hold-progress > .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #00f, #0ff);
      transition: width 0.05s linear;
    }

    /* Canvas particles */
    .particles-canvas {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 20;
    }

    /* –º–∞–ª–µ–Ω—å–∫–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
    .mini-modal {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 320px;
      max-width: calc(100% - 40px);
      background: #0f1720;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.7);
      padding: 14px;
      display: none;
      z-index: 1200;
      text-align: center;
    }
    .mini-modal img { width: 140px; height: auto; margin: 8px auto; display: block; border-radius: 10px; }
    .mini-modal .title { font-size: 18px; color: #fff; margin-top: 6px; font-weight: 700; }
    .mini-modal .subtitle { font-size: 13px; color: #b9c2c9; margin-top: 6px; }
    .mini-modal .code-btn {
      margin-top: 12px;
      display: inline-block;
      background: #0ea5a4;
      color: #04111a;
      font-weight: 800;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      user-select: all;
    }
    .mini-modal .copy-small { display:block; font-size: 11px; color: #9aa3a9; margin-top: 6px; }

    @media (max-width: 520px) {
      .lotto-grid { grid-template-columns: repeat(2, 1fr); }
      .cube { width: 140px; height: 140px; }
    }
  </style>
</head>
<body>
  <div id="loader">
    <div class="spinner"></div>
  </div>

  <div id="app">
    <!-- –í–∫–ª–∞–¥–∫–∞ 1 ‚Äî –†—É–ª–µ—Ç–∫–∞ -->
<div class="tab-content active" id="tab1">
  <div class="top-bar">
    <img id="profilePic" src="" alt="Profile Picture">
    <span id="profileName">User</span>
  </div>

  <div class="container">
    <div class="news-banner">
      <span>Turbo Gifts here!</span>
      <button onclick="window.location.href='https://t.me/AutoGiftysBot'">Open Gifts</button>
    </div>

    <div class="mode-selector">
      <div class="mode-option active" data-price="35" data-link="https://t.me/$zLCg1Xa26UlZDQAA5UvFqNpOjqo">35‚òÖ</div>
      <div class="mode-option" data-price="50" data-link="https://t.me/$6k1Z8Ha26UlaDQAAVovivYcjdqU">50‚òÖ</div>
      <div class="mode-option" data-price="150" data-link="https://t.me/$SR_sP3a26UlbDQAAvm5lKSwJrGg">150‚òÖ</div>
    </div>

    <div class="reel" id="reel">
      <div class="pointer-line"></div>
      <div class="gifts-wrapper" id="giftsTrack"></div>
    </div>

    <button id="spinButton">Try your luck 35‚òÖ</button>
    <a href="https://t.me/StarsotekaRobot?start=d846ae70" class="extra-button outlined">–ö—É–ø–∏—Ç—å 50‚òÖ –∑–∞ 79‚ÇΩ</a>
    <div class="swipe-roulette-container">
      <div class="swipe-text">What can I drop?</div>
      <div class="embla" id="embla">
        <div class="embla__container" id="emblaTrack"></div>
      </div>
    </div>
  </div>

  <div class="modal" id="modal">
    <img id="modalImage" class="modal-image" src="nothing_drop.png" alt="Prize image" style="display: none;">
    <div class="modal-animation" id="modalLottie"></div>
    <h2>Try your luck next time üçÄ</h2>
    <button id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <footer class="footer-text">¬© 2025 All rights reserved</footer>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ 2 ‚Äî –ù–û–í–ê–Ø (–Ω–µ —Ç—Ä–æ–≥–∞–π —Ç–∞–±1 —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ) -->
<div class="tab-content" id="tab2">
  <button class="rules-btn" id="openRules">–ü—Ä–∞–≤–∏–ª–∞</button>

  <div class="tab2-wrapper">
    <h2 style="margin:0 0 6px; font-size:20px; font-weight:700; text-align:center;">–ö—É–±–∏–∫–∏ —É–¥–∞—á–∏</h2>
    <div style="color:#bfc9cf; font-size:14px; text-align:center; margin-bottom:6px;">–ù–∞–∂–º–∏ -> –æ–ø–ª–∞—Ç–∞ -> —É–¥–µ—Ä–∂–∏–≤–∞–π 2.5—Å, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫—É–±–∏–∫</div>

    <div class="lotto-grid" id="lottoGrid">
      <!-- –ö—É–±–∏–∫–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
    </div>
  </div>

  <!-- –∫–∞–Ω–≤–∞ –¥–ª—è —á–∞—Å—Ç–∏—Ü (–æ–¥–Ω–∞ –Ω–∞ –≤—Å—é –≤–∫–ª–∞–¥–∫—É, —Ä–∏—Å—É–µ–º –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö –∫—É–±–∏–∫–∞ –≤–æ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è) -->
  <canvas id="particlesCanvas" class="particles-canvas"></canvas>

  <!-- –†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–µ –º–∞–ª–µ–Ω—å–∫–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–Ω–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ) -->
  <div id="resultModal" class="mini-modal">
    <img id="resultImage" src="" alt="result" />
    <div class="title" id="resultTitle">–ù–µ –≤ —ç—Ç–æ—Ç —Ä–∞–∑...</div>
    <div class="subtitle" id="resultSubtitle">–ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞</div>
    <div style="margin-top:8px;">
      <div id="winCodeContainer" style="display:none;">
        <div class="code-btn" id="winCode">12345</div>
        <div class="copy-small" id="copyHint">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–π –∫–æ–¥ @vovnx –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞</div>
      </div>
      <button id="closeResult" style="margin-top:10px; padding:8px 12px; border-radius:8px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∏–ª–∞ –º–∞–ª–µ–Ω—å–∫–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ -->
  <div id="rulesModal" class="mini-modal" style="width:300px;">
    <div style="font-weight:800; font-size:16px; margin-bottom:8px;">–ü—Ä–∞–≤–∏–ª–∞</div>
    <div style="color:#bfc9cf; font-size:13px; text-align:left;">1) –ù–∞–∂–º–∏ –Ω–∞ –∫—É–±–∏–∫. 2) –û—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã. 3) –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —É–¥–µ—Ä–∂–∏–≤–∞–π 2.5 —Å–µ–∫—É–Ω–¥—ã. 4) –í–æ–∑–º–æ–∂–µ–Ω –≤—ã–∏–≥—Ä—ã—à —Å —à–∞–Ω—Å–æ–º 30%.</div>
    <button id="closeRulesBtn" style="margin-top:12px; padding:8px 12px; border-radius:8px;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
<div class="tab-container">
  <div class="tab" onclick="changeTab(1)">
    <img src="3664550.png" alt="Tab 1" />
  </div>
  <div class="tab" onclick="changeTab(2)">
    <img src="–ú–æ–Ω–µ—Ç–∞.png" alt="Tab 2" />
  </div>
</div>
  </div>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script src="https://unpkg.com/embla-carousel/embla-carousel.umd.js"></script>

<script>
  // ------------------ –ø—Ä–æ—Ñ–∏–ª—å (–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ------------------
  function updateProfile() {
    if (window.Telegram && Telegram.WebApp) {
      const user = Telegram.WebApp.initDataUnsafe?.user;
      if (user) {
        document.getElementById("profileName").textContent = user.first_name || "User";
        if (user.photo_url) {
          document.getElementById("profilePic").src = user.photo_url;
        }
      }
    }
  }

  // ------------------ –≤–∫–ª–∞–¥–∫–∏ ------------------
  function changeTab(tabNumber) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.getElementById('tab' + tabNumber).classList.add('active');
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab')[tabNumber - 1].classList.add('active');

    // –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –≤–∫–ª–∞–¥–∫—É 2 ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    if (tabNumber === 2) {
      initTab2();
    }
  }

  // ------------------ –ü–æ–¥–∞—Ä–∫–∏ / —Ä—É–ª–µ—Ç–∫–∞ ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –±—ã–ª–æ ------------------
  const gifts = [
    "1CHzB4K5FantEZu.png", "680e5d8f8bf66.png", "toTNAm2yurDAiqK.png", "U8z9ivaScNyJ86V.png",
    "Oj0IhQW5D5QyVFf.png", "PQM9MVSTAF7sQ12.png", "nothing_drop.png",
    "pudbsohqxfD98gc.png", "bvK9PmcyFgAh4gP.png", "q2c0eUx5k8krA97.png"
  ];

  const fullGifts = [];
  for (let i = 0; i < 10; i++) fullGifts.push(...gifts);

  const giftsTrack = document.getElementById("giftsTrack");
  fullGifts.forEach(g => {
    const div = document.createElement("div");
    div.className = "gift";
    const img = document.createElement("img");
    img.src = g;
    div.appendChild(img);
    giftsTrack.appendChild(div);
  });

  // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ---
  const modalImage = document.getElementById("modalImage");
  modalImage.src = "nothing_drop.png";
  modalImage.style.display = "block";

  // --- –†–µ–∂–∏–º—ã ---
  const spinButton = document.getElementById("spinButton");
  const options = document.querySelectorAll('.mode-option');
  let selectedLink = "https://t.me/$OEtEnkq5wEppDQAAuOeA4xzWyR4";

  options.forEach(option => {
    option.addEventListener('click', () => {
      options.forEach(o => o.classList.remove('active'));
      option.classList.add('active');
      const price = option.getAttribute('data-price');
      selectedLink = option.getAttribute('data-link');
      spinButton.textContent = `Try your luck ${price}‚òÖ`;
    });
  });

  // --- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ ---
  let spinning = false;
  spinButton.onclick = () => {
    if (spinning) return;
    Telegram.WebApp.openInvoice(selectedLink);
  };

  // --- –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã (–¥–ª—è –≤–∫–ª–∞–¥–∫–∏ 1) ---
  Telegram.WebApp.onEvent("invoiceClosed", function(event) {
    if (event.status === "paid") {
      // –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏1 ‚Äî –∫–∞–∫ –±—ã–ª–æ
      spinning = true;
      const prize = "nothing_drop.png";
      const idx = fullGifts.findIndex((v, i) => v === prize) + 5 * gifts.length;
      const offset = idx * 120 - (document.getElementById("reel").offsetWidth / 2 - 60);
      gsap.to(giftsTrack, {
        x: -offset,
        duration: 6,
        ease: "power5.inOut",
        onComplete() {
          document.getElementById("modal").style.display = "flex";
          document.getElementById("modalLottie").innerHTML = "";
          lottie.loadAnimation({
            container: document.getElementById("modalLottie"),
            renderer: "svg",
            loop: true,
            autoplay: true,
            path: "https://lottie.host/2e7b308e-92b6-495c-a96b-cf93e02eb7b4/BiwZQ7vQaf.json"
          });
        }
      });
    }
  });

  document.getElementById("closeModal").onclick = () => {
    document.getElementById("modal").style.display = "none";
    gsap.set(giftsTrack, { x: 0 });
    spinning = false;
  };

  // Embla
  const emblaTrack = document.getElementById("emblaTrack");
  gifts.forEach(g => {
    const slide = document.createElement("div");
    slide.className = "embla__slide";
    const img = document.createElement("img");
    img.src = g;
    slide.appendChild(img);
    emblaTrack.appendChild(slide);
  });

  EmblaCarousel(document.getElementById("embla"), {
    loop: false,
    align: "start",
    dragFree: true
  });

  // --- –õ–æ–∞–¥–µ—Ä ---
  window.addEventListener('load', function () {
    const MIN_LOADING_TIME = 1500;
    const startTime = Date.now();

    const checkReady = () => {
      if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initData) {
        const elapsed = Date.now() - startTime;
        const remaining = Math.max(0, MIN_LOADING_TIME - elapsed);

        setTimeout(() => {
          Telegram.WebApp.ready();
          document.getElementById('loader').style.display = 'none';
          document.getElementById('app').style.display = 'block';
        }, remaining);
      } else {
        setTimeout(checkReady, 100);
      }
    };

    checkReady();
  });

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
  updateProfile();
  changeTab(1);

  // ------------------ –í–ö–õ–ê–î–ö–ê 2: –ª–æ–≥–∏–∫–∞ –∫—É–±–∏–∫–æ–≤, –æ–ø–ª–∞—Ç–∞, —É–¥–µ—Ä–∂–∞–Ω–∏–µ, —á–∞—Å—Ç–∏—Ü—ã, –º–æ–¥–∞–ª–∫–∏ ------------------

  // –ú–∞—Å—Å–∏–≤—ã –¥–ª—è lottie –∏ –∏–Ω–≤–æ–π—Å–æ–≤ ‚Äî –ø–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ–∏ —Å—Å—ã–ª–∫–∏ —Å—é–¥–∞
  // –ü—Ä–∏–º–µ—Ä: "https://assets9.lottiefiles.com/packages/lf20_XXXXX.json"
  const lottieLinks = [
    "https://assets9.lottiefiles.com/packages/lf20_1.json", // –∑–∞–º–µ–Ω–∏—Ç–µ
    "https://assets9.lottiefiles.com/packages/lf20_2.json",
    "https://assets9.lottiefiles.com/packages/lf20_3.json",
    "https://assets9.lottiefiles.com/packages/lf20_4.json",
    "https://assets9.lottiefiles.com/packages/lf20_5.json"
  ];

  // –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–æ—Ç—Ç–∏ (—Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏ openInvoice —Å—Å—ã–ª–∫–∏)
  const invoiceLinks = [
    "https://t.me/$invoice_link_1", // –∑–∞–º–µ–Ω–∏—Ç–µ
    "https://t.me/$invoice_link_2",
    "https://t.me/$invoice_link_3",
    "https://t.me/$invoice_link_4",
    "https://t.me/$invoice_link_5"
  ];

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è
  const HOLD_REQUIRED_MS = 2500; // 2.5 —Å–µ–∫—É–Ω–¥—ã
  const WIN_CHANCE = 0.30; // 30% —à–∞–Ω—Å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏

  // –°–æ—Å—Ç–æ—è–Ω–∏—è
  let tab2Initialized = false;
  let lastPaymentIndex = null; // –∏–Ω–¥–µ–∫—Å –∫—É–±–∏–∫–∞ –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è —É–¥–µ—Ä–∂–∞–Ω–∏–µ
  let paymentPendingFor = null; // –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç –∏–Ω–≤–æ–π—Å (—á—Ç–æ–±—ã —Å–≤–µ—Ä—è—Ç—å –ø—Ä–∏ invoiceClosed)

  // DOM
  const lottoGrid = document.getElementById("lottoGrid");
  const particlesCanvas = document.getElementById("particlesCanvas");
  const resultModal = document.getElementById("resultModal");
  const resultImage = document.getElementById("resultImage");
  const resultTitle = document.getElementById("resultTitle");
  const resultSubtitle = document.getElementById("resultSubtitle");
  const winCodeContainer = document.getElementById("winCodeContainer");
  const winCodeEl = document.getElementById("winCode");
  const closeResult = document.getElementById("closeResult");
  const openRulesBtn = document.getElementById("openRules");
  const rulesModal = document.getElementById("rulesModal");
  const closeRulesBtn = document.getElementById("closeRulesBtn");

  // particles canvas context
  let pcCtx, pcW, pcH;
  function resizeCanvas() {
    particlesCanvas.width = innerWidth * devicePixelRatio;
    particlesCanvas.height = innerHeight * devicePixelRatio;
    particlesCanvas.style.width = innerWidth + "px";
    particlesCanvas.style.height = innerHeight + "px";
    pcCtx = particlesCanvas.getContext('2d');
    pcCtx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    pcW = innerWidth; pcH = innerHeight;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  // –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü
  class Particle {
    constructor(x,y){
      this.x = x; this.y = y;
      const ang = Math.random()*Math.PI*2;
      const speed = 30 + Math.random()*180;
      this.vx = Math.cos(ang)*speed;
      this.vy = Math.sin(ang)*speed;
      this.life = 800 + Math.random()*600;
      this.size = 4 + Math.random()*6;
      this.ttl = this.life;
      this.color = `rgba(255,255,255,${0.9 + Math.random()*0.1})`;
    }
    update(dt){
      const s = dt/16;
      this.x += this.vx * (dt/1000);
      this.y += this.vy * (dt/1000) + 60*(dt/1000); // gravity-like
      this.ttl -= dt;
    }
    draw(ctx){
      const t = Math.max(0, this.ttl / this.life);
      ctx.globalAlpha = t;
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size * (0.6 + (1-t)*0.8), 0, Math.PI*2);
      ctx.fill();
    }
    alive(){ return this.ttl > 0; }
  }
  let particles = [];
  let lastFrame = performance.now();
  let particlesActive = false;
  function particleLoop(now){
    const dt = now - lastFrame;
    lastFrame = now;
    if(particlesActive){
      // update
      particles.forEach(p => p.update(dt));
      particles = particles.filter(p => p.alive());
      // clear
      pcCtx.clearRect(0,0,pcW,pcH);
      // draw
      particles.forEach(p => p.draw(pcCtx));
      if(particles.length===0){
        particlesActive=false;
        pcCtx.clearRect(0,0,pcW,pcH);
      }
    }
    requestAnimationFrame(particleLoop);
  }
  particleLoop(lastFrame);

  // –í—Å–ø–æ–º–æ–≥: —Å–ø–∞–≤–Ω —á–∞—Å—Ç–∏—Ü –≤ —Ç–æ—á–∫–µ x,y
  function spawnParticles(x,y,amount=60){
    particlesActive = true;
    for(let i=0;i<amount;i++){
      particles.push(new Particle(x, y));
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 5 –∫—É–±–∏–∫–æ–≤ –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
  function initTab2(){
    if(tab2Initialized) return;
    tab2Initialized = true;

    // –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã
    const indices = [0,1,2,3,4].sort(()=>Math.random()-0.5);

    indices.forEach((srcIdx, displayIdx) => {
      const cube = document.createElement('div');
      cube.className = 'cube';
      cube.dataset.index = srcIdx; // –∏–Ω–¥–µ–∫—Å –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –º–∞—Å—Å–∏–≤–∞—Ö
      cube.innerHTML = `
        <div class="lottie-holder" id="lottie-${srcIdx}"></div>
        <div class="hold-overlay"></div>
        <div class="hold-progress"><div class="bar"></div></div>
        <div class="hold-hint">–ù–∞–∂–º–∏ –∏ –¥–µ—Ä–∂–∏</div>
      `;
      lottoGrid.appendChild(cube);

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º lottie —á–µ—Ä–µ–∑ lottie-web –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
      try {
        lottie.loadAnimation({
          container: document.getElementById(`lottie-${srcIdx}`),
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: lottieLinks[srcIdx] || lottieLinks[0]
        });
      } catch(e){
        // –µ—Å–ª–∏ lottie –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è ‚Äî –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ
        console.warn("lottie load error", e);
      }

      setupCubeEvents(cube, srcIdx);
    });
  }

  // –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫—É–±–∏–∫–∞: –æ–ø–ª–∞—Ç–∞ -> –æ–∂–∏–¥–∞–Ω–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è -> —É–¥–µ—Ä–∂–∞–Ω–∏–µ 2.5—Å -> —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  function setupCubeEvents(cubeEl, srcIdx){
    // pointer events (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º—ã—à–∏ + touch)
    let holdTimer = null;
    let holdStart = null;
    let holding = false;
    let holdProgressBar = cubeEl.querySelector('.hold-progress > .bar');
    const overlay = cubeEl.querySelector('.hold-overlay');

    // —Å–æ–±—ã—Ç–∏–µ –Ω–∞–∂–∞—Ç–∏—è: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∏–Ω–≤–æ–π—Å —Å—Ä–∞–∑—É
    cubeEl.addEventListener('pointerdown', (e) => {
      e.preventDefault();
      // –æ—Ç–∫—Ä–æ–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è —ç—Ç–æ–≥–æ srcIdx
      paymentPendingFor = srcIdx;
      // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∏–Ω–≤–æ–π—Å - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É —Å—Å—ã–ª–∫—É
      const invoiceLink = invoiceLinks[srcIdx] || invoiceLinks[0];
      try {
        Telegram.WebApp.openInvoice(invoiceLink);
      } catch(err){
        // –ï—Å–ª–∏ Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ, –º–æ–∂–Ω–æ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É (–¥–ª—è —Ç–µ—Å—Ç–∞)
        console.warn("openInvoice failed (maybe running in non-Telegram environment):", err);
        // –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ 1s:
        setTimeout(() => {
          // –≤—ã–∑–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–∞–∫ –±—É–¥—Ç–æ –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞
          handleInvoiceClosed({ status: "paid", forIndex: srcIdx });
        }, 700);
      }
    });

    // Pointer up/cancel: –æ—Ç–º–µ–Ω—è–µ–º —É–¥–µ—Ä–∂–∞–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
    const cancelHold = () => {
      if(holdTimer) { clearTimeout(holdTimer); holdTimer = null; }
      holding = false;
      holdStart = null;
      holdProgressBar.style.width = '0%';
      overlay.style.boxShadow = 'inset 0 0 0 2px transparent';
    };

    // –ó–∞–ø—É—Å–∫ —É–¥–µ—Ä–∂–∞–Ω–∏—è: —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ lastPaymentIndex === srcIdx (–æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞)
    function tryStartHold(e){
      if(lastPaymentIndex !== srcIdx) return;
      if(holding) return;
      holding = true;
      holdStart = performance.now();
      overlay.style.boxShadow = 'inset 0 0 0 2px rgba(0,200,255,0.18)';
      // animate progress
      const start = performance.now();
      holdTimer = setInterval(() => {
        const elapsed = performance.now() - start;
        const pct = Math.min(100, (elapsed / HOLD_REQUIRED_MS) * 100);
        holdProgressBar.style.width = pct + '%';
        if(elapsed >= HOLD_REQUIRED_MS){
          clearInterval(holdTimer);
          holdTimer = null;
          // spawn particles from center of cube
          const rect = cubeEl.getBoundingClientRect();
          const cx = rect.left + rect.width/2;
          const cy = rect.top + rect.height/2;
          spawnParticles(cx, cy, 120);
          // –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          finalizeOpen(srcIdx);
          holding = false;
          holdProgressBar.style.width = '100%';
          overlay.style.boxShadow = 'inset 0 0 0 2px transparent';
        }
      }, 20);
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏ pointerup/leave/cancel
    cubeEl.addEventListener('pointerup', (e) => {
      // –µ—Å–ª–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–¥–µ—Ç ‚Äî –æ—Ç–º–µ–Ω—è–µ–º (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è)
      cancelHold();
    });
    cubeEl.addEventListener('pointercancel', cancelHold);
    cubeEl.addEventListener('pointerleave', cancelHold);

    // –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞—Å–∞–µ—Ç—Å—è/–Ω–∞–∂–∏–º–∞–µ—Ç –∏ –æ–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞, —Å—Ç–∞—Ä—Ç—É–µ–º —É–¥–µ—Ä–∂–∞–Ω–∏–µ
    // –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –Ω–∞—á–∞—Ç—å –ø—Ä–∏ pointerdown, –Ω–æ —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –∏–Ω–≤–æ–π—Å–∞,
    // –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —É–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–∏—à—ë–ª —Å—Ç–∞—Ç—É—Å "paid" –∏ lastPaymentIndex —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
    // –ü–æ—ç—Ç–æ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ pointerdown –≤—ã—à–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω–≤–æ–π—Å, –∞ –∑–¥–µ—Å—å –¥–æ–±–∞–≤–∏–º pointerdown listener –¥–ª—è –Ω–∞—á–∞–ª–∞ hold,
    cubeEl.addEventListener('pointerdown', (e) => {
      // –µ—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ —É–∂–µ –ø—Ä–æ—à–ª–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∫—É–±–∏–∫–∞, –Ω–∞—á–Ω–µ–º —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ç–∞–π–º–∞—É—Ç–∞,
      // –∏–Ω–∞—á–µ ‚Äî –Ω–∏—á–µ–≥–æ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–µ–Ω –æ–ø–ª–∞—Ç–∏—Ç—å).
      setTimeout(() => {
        tryStartHold(e);
      }, 220); // –Ω–µ–±–æ–ª—å—à–æ–π –±—É—Ñ–µ—Ä –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
    });

    // –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –Ω–∞–∂–∞–ª –Ω–∞ –∫—É–±–∏–∫ –∏ –æ–ø–ª–∞—Ç–∏–ª —Ä–∞–Ω—å—à–µ (—Ç.–µ. lastPaymentIndex —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω),
    // –º–æ–∂–Ω–æ –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ:
    // (–¥–æ–±–∞–≤–ª—è—Ç—å –≤–∏–∑—É–∞–ª –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ lastPaymentIndex === srcIdx)
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞ (—Å–ª—É—à–∞–µ–º global)
  function handleInvoiceClosed(event){
    // event –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º Telegram.WebApp event, –ª–∏–±–æ –Ω–∞—à –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π (forIndex)
    // –≤ Telegram WebApp API, –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö –º–æ–∂–Ω–æ —Å–ª—É—à–∞—Ç—å invoiceClosed
    // –ú—ã –±—É–¥–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å lastPaymentIndex –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å == paid –∏ paymentPendingFor —Å–æ–≤–ø–∞–¥–∞–µ—Ç.
    const status = event.status;
    const forIndex = (typeof event.forIndex !== 'undefined') ? event.forIndex : paymentPendingFor;
    if(status === "paid"){
      lastPaymentIndex = forIndex;
      // —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ–¥—Å–≤–µ—Ç –∫—É–±–∏–∫–∞
      const cube = document.querySelector(`.cube[data-index='${forIndex}']`);
      if(cube){
        const overlay = cube.querySelector('.hold-overlay');
        overlay.style.boxShadow = 'inset 0 0 0 3px rgba(0,200,255,0.2)';
        // –ø–æ–¥—Å–∫–∞–∑–∫–∞: –º–æ–∂–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å
        const hint = cube.querySelector('.hold-hint');
        if(hint) hint.textContent = '–£–¥–µ—Ä–∂–∏–≤–∞–π 2.5—Å';
      }
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º paymentPendingFor
      paymentPendingFor = null;
    } else {
      // –æ–ø–ª–∞—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞/–Ω–µ—É—Å–ø–µ—à–Ω–∞ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      paymentPendingFor = null;
    }
  }

  // –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å–ª—É—à–∞—Ç–µ–ª—é Telegram, –µ—Å–ª–∏ –µ—Å—Ç—å
  try {
    Telegram.WebApp.onEvent("invoiceClosed", function(event) {
      // event.status === "paid" | "cancelled" | "failed"
      handleInvoiceClosed(event);
    });
  } catch(e){
    // –µ—Å–ª–∏ Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å handleInvoiceClosed –≤—Ä—É—á–Ω—É—é
    console.warn("Telegram.WebApp.onEvent not available in this environment");
  }

  // –§–∏–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç–∏—è –∫—É–±–∏–∫–∞ (–ø–æ—Å–ª–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å)
  function finalizeOpen(srcIdx){
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∞/–ø—Ä–æ–∏–≥—Ä—ã—à —Å–ª—É—á–∞–π–Ω–æ —Å —à–∞–Ω—Å–æ–º WIN_CHANCE
    const win = Math.random() < WIN_CHANCE;
    if(win){
      // –≤—ã–∏–≥—Ä—ã–≤–∞–µ–º: –¥—Ä—É–≥–æ–µ —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç + –∫–æ–¥
      resultImage.src = "https://via.placeholder.com/400x250.png?text=Desk+Calendar"; // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—ë –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏
      resultTitle.textContent = "–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ Desk Calendar!";
      resultSubtitle.textContent = "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ @vovnx";
      const code = String(Math.floor(10000 + Math.random()*90000)); // 5 —Ü–∏—Ñ—Ä
      winCodeEl.textContent = code;
      winCodeContainer.style.display = 'block';
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∏–Ω–∏-–º–æ–¥–∞–ª–∫—É
      showResultModal();

      // –∫–ª–∏–∫ –ø–æ –∫–æ–¥—É ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
      winCodeEl.onclick = () => {
        navigator.clipboard.writeText(code).then(() => {
          // –Ω–µ–±–æ–ª—å—à–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞
          winCodeEl.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
          setTimeout(()=> winCodeEl.textContent = code, 1200);
        }).catch(()=>{/* ignore */});
      };
    } else {
      // –ø—Ä–æ–∏–≥—Ä—ã—à
      resultImage.src = "https://via.placeholder.com/400x250.png?text=–ù–µ+–≤+—ç—Ç–æ—Ç+—Ä–∞–∑"; // –∑–∞–º–µ–Ω–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      resultTitle.textContent = "–ù–µ –≤ —ç—Ç–æ—Ç —Ä–∞–∑...";
      resultSubtitle.textContent = "–ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞";
      winCodeContainer.style.display = 'none';
      showResultModal();
    }

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º lastPaymentIndex, —á—Ç–æ–±—ã –Ω–∞–¥–æ –±—ã–ª–æ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
    lastPaymentIndex = null;
  }

  function showResultModal(){
    resultModal.style.display = 'block';
  }
  function hideResultModal(){
    resultModal.style.display = 'none';
  }
  closeResult.addEventListener('click', hideResultModal);

  // –ü—Ä–∞–≤–∏–ª–∞
  openRulesBtn.addEventListener('click', () => { rulesModal.style.display = 'block'; });
  closeRulesBtn.addEventListener('click', () => { rulesModal.style.display = 'none'; });

  // –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ finalizeOpen

  // –¢–µ—Å—Ç–æ–≤—ã–π —Ö–∞–∫: –µ—Å–ª–∏ Telegram.WebApp –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç invoiceClosed –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±—Ä–æ—Å–∞–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å), 
  // –º–æ–∂–Ω–æ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ:
  // window.simulatePay = (idx) => handleInvoiceClosed({status:"paid", forIndex: idx});

  // ----------------- –ø—Ä–æ—á–µ–µ: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏ ‚Äî –∑–∞–∫—Ä—ã—Ç—å -----------------
  window.addEventListener('click', function(e){
    if(e.target === resultModal) hideResultModal();
    if(e.target === rulesModal) rulesModal.style.display = 'none';
  });

  // –ù–µ–±–æ–ª—å—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç changeTab(2) –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ ‚Äî initTab2 —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
  // (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—à–µ).

  // ----------------- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –µ—Å–ª–∏ Telegram –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ç–µ—Å—Ç–∞ -----------------
  // (–ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å window.simulatePay(–∏–Ω–¥–µ–∫—Å) –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∞.)
  window.simulatePay = (idx) => {
    handleInvoiceClosed({status:"paid", forIndex: idx});
  };

  // (–î–æ–ø) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ 2 –±—ã–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ), –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
  if(document.getElementById('tab2').classList.contains('active')){
    initTab2();
  }
</script>

</body>
</html>
